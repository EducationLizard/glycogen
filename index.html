<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>DOOM</title>
  <link rel="icon" href="https://i.ibb.co/ZHvYsT5/open-uri20210108-68-lujeec.png" type="image/png">
  <style type="text/css">
    .dosbox-container { width: 100vw; height: 100vh; }
    .dosbox-container > .dosbox-overlay { background: url(DOOM.png); }
    canvas {
      width: 100%;
      height: 100%;
      margin: auto;
      padding: 0;
    }
    .dosbox-controls {
      padding-left: 50px;
    }
  </style>
  <script src="https://github.com/EducationLizard/glycogen/raw/main/DOS-API.js"></script>
  <script src="https://js-dos.com/6.22/current/js-dos.js"></script>
</head>
<body>
  <main>
    <section id="dosbox-section" class="dosbox-container">
      <canvas id="jsdos"></canvas>
      <div class="dosbox-controls">
        <button onclick="dosbox.requestFullscreen();">Make fullscreen</button>
        <br/>
        <p><b>Controls:</b> Move: UP, DOWN, LEFT, RIGHT; Use: W; Fire: S; Speed on: SPACE; Strafe on: ALT; Strafe: A, D;</p>
      </div>
    </section>
  </main>

  <script type="text/javascript">
    var dosbox = new Dosbox({
      id: "dosbox",
      onload: function (dosbox) {
        dosbox.run("https://github.com/EducationLizard/glycogen/raw/main/DOOM-@evilution.zip", "./DOOM/DOOM.EXE");
      },
      onrun: function (dosbox, app) {
        console.log("App '" + app + "' is runned");
      }
    });
  </script>

  <script type="text/javascript">
    var els, i, len, title;
    var konamiCode = '38,38,40,40,37,39,37,39,66,65';
    var keyPresses = [];
    var checkKonami = function (e) {
      keyPresses.push(e.keyCode);
      if (keyPresses.slice(keyPresses.length - 10).join() === konamiCode) {
        runKonami();
      }
    };
    var runKonami = function () {
      console.log('konami code activated!');
      dataLayer.push({
        'event': 'doom_launched'
      });

      // Create new site section
      var doomSection = document.createElement('section');
      doomSection.setAttribute('id', 'doomSection');

      // Create and append dosbox container
      var dosboxContainer = document.createElement('canvas');
      dosboxContainer.setAttribute('id', 'jsdos');
      doomSection.appendChild(dosboxContainer);

      var div1 = document.createElement('div');
      div1.setAttribute('class', 'row no-gutters');
      doomSection.appendChild(div1);

      var div2 = document.createElement('div');
      div2.setAttribute('class', 'col-md-7 left-fullwidth-block white-bg my-auto');
      div1.appendChild(div2);

      var div3 = document.createElement('div');
      div3.setAttribute('class', 'content-center');
      div2.appendChild(div3);

      // Create and append controls list
      var controls = ["Move: UP, DOWN, LEFT, RIGHT", "Use: W", "Fire: S", "Speed on: SPACE", "Strafe on: ALT", "Strafe: A, D"];
      var controlsHeading = document.createElement('h3');
      controlsHeading.setAttribute('id', 'controls-heading');
      controlsHeading.innerText = 'Controls';
      var controlsList = document.createElement('ul');
      controlsList.setAttribute('id', 'controls-list');
      for (var i = 0; i < controls.length; i++) {
        var item = document.createElement('li');
        item.appendChild(document.createTextNode(controls[i]));
        controlsList.appendChild(item);
      }

      // Create and append Fullscreen button
      var doomFullscreenBtn = document.createElement('button');
      doomFullscreenBtn.setAttribute('id', 'fullscreenBtn');
      doomFullscreenBtn.setAttribute('onclick', 'ci.fullscreen()');
      doomFullscreenBtn.innerText = 'Fullscreen';

      // Append elements to the doomSection
      div3.appendChild(controlsHeading);
      div3.appendChild(controlsList);
      div3.appendChild(doomFullscreenBtn);

      // Inject section
      document.querySelector('body > main').prepend(doomSection);

      // Run dosbox and extract + load DOOM
      Dos(document.getElementById("jsdos"), {
        wdosboxUrl: "https://js-dos.com/6.22/current/wdosbox.js",
        // cycles: 1000,
        // autolock: false,
      }).ready(function (fs, main) {
        fs.extract("https://github.com/EducationLizard/glycogen/raw/main/DOOM-@evilution.zip").then(function () {
          main(["-c", "cd DOOM", "-c", "DOOM.EXE"]).then(function (ci) {
            window.ci = ci;
          });
        });
      });
    };
    document.addEventListener('keyup', checkKonami);
  </script>
</body>
</html>
